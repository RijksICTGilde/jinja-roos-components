{% import 'components/_event_mixin.j2' as events %}
{% set id = _component_context.id | default('') %}
{% set name = _component_context.name | default('') %}
{% set label = _component_context.label | default('') %}
{% set value = _component_context.value | default('') %}
{% set placeholder = _component_context.placeholder | default('') %}
{% set rows = _component_context.rows | default(4) %}
{% set size = _component_context.size | default('max') %}
{% set helper_text = _component_context.helperText | default('') %}
{% set expandable_helper_text = _component_context.expandableHelperText | default(false) %}
{% set expandable_helper_text_title = _component_context.expandableHelperTextTitle | default('More info') %}
{% set error_text = _component_context.errorText | default('') %}
{% set warning_text = _component_context.warningText | default('') %}
{% set has_error = _component_context.hasError | default(false) %}
{% set invalid = _component_context.invalid | default(false) %}
{% set required = _component_context.required | default(false) %}
{% set disabled = _component_context.disabled | default(false) %}
{% set readonly = _component_context.readonly | default(false) %}
{% set additional_class = _component_context.get('class', '') %}

{# Build CSS classes #}
{% set field_classes = ['utrecht-form-field', 'utrecht-form-field--text', 'rvo-form-field'] %}
{% if size != 'md' and size != 'max' %}
    {% set field_classes = field_classes + ['rvo-form-field--' + size] %}
{% endif %}
{% if additional_class %}
    {% set field_classes = field_classes + [additional_class] %}
{% endif %}

{% set textarea_classes = ['utrecht-textarea', 'utrecht-textarea--html-textarea'] %}
{% if size != 'max' %}
    {% set textarea_classes = textarea_classes + ['utrecht-textarea--' + size] %}
{% endif %}
{% if has_error or error_text %}
    {% set textarea_classes = textarea_classes + ['utrecht-textarea--invalid'] %}
{% endif %}
{% if disabled %}
    {% set textarea_classes = textarea_classes + ['utrecht-textarea--disabled'] %}
{% endif %}

<div role="group" 
     aria-labelledby="{{ id }}-label"
     class="{{ field_classes | join(' ') }}">
    
    {# Label and helper/error text #}
    <div class="rvo-form-field__label">
        <label class="rvo-label{% if required %} rvo-label--required{% endif %}" id="{{ id }}-label" for="{{ id }}">
            {{ label }}
        </label>
        
        {% if helper_text and not error_text and not warning_text %}
            <div class="utrecht-form-field-description" id="{{ id }}-helper">
                {% if expandable_helper_text %}
                    <details class="rvo-expandable-content">
                        <summary class="rvo-expandable-content__summary">
                            <span class="utrecht-icon rvo-icon rvo-icon-info rvo-icon--md rvo-icon--hemelblauw" 
                                  role="img" 
                                  aria-label="Info"></span>{{ expandable_helper_text_title }}
                        </summary>
                        <div class="rvo-expandable-content__details">
                            {{ helper_text }}
                        </div>
                    </details>
                {% else %}
                    {{ helper_text }}
                {% endif %}
            </div>
        {% endif %}
        
        {% if error_text %}
            <div class="utrecht-form-field-description utrecht-form-field-description--invalid rvo-form-feedback rvo-form-feedback--error">
                <span class="utrecht-icon rvo-icon rvo-icon-foutmelding rvo-icon--md rvo-status-icon-foutmelding" 
                      role="img" 
                      aria-label="Foutmelding"></span>{{ error_text }}
            </div>
        {% endif %}
        
        {% if warning_text %}
            <div class="utrecht-form-field-description utrecht-form-field-description--warning rvo-form-feedback rvo-form-feedback--warning">
                <span class="utrecht-icon rvo-icon rvo-icon-waarschuwing rvo-icon--md rvo-status-icon-waarschuwing" 
                      role="img" 
                      aria-label="Waarschuwing"></span>{{ warning_text }}
            </div>
        {% endif %}
    </div>
    
    {# Textarea element #}
    <textarea id="{{ id }}"
              {% if name %}name="{{ name }}"{% endif %}
              placeholder="{{ placeholder }}"
              class="{{ textarea_classes | join(' ') }}"
              rows="{{ rows }}"
              dir="auto"
              {% if disabled %}disabled{% endif %}
              {% if readonly %}readonly{% endif %}
              {% if has_error or error_text %}aria-invalid="true"{% endif %}
              {% if helper_text %}aria-describedby="{{ id }}-helper"{% endif %}
              {{ events.render_extra_attributes(_component_context) }}>{{ value }}</textarea>
    
</div>